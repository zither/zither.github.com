
<!doctype html>
<html lang="zh-CN">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <title>Laravel IoC 依赖注入 | 槐花九九</title>
  <meta name="author" content="MiniMee" />
  <link href="/atom.xml" rel="alternate" title="Tom Preston-Werner" type="application/atom+xml" />
  <link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" type="text/css" href="/css/highlight/99_solarized_dark.css" />
  <script src="/js/highlight.pack.js"></script>
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-33950131-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
</head>
<body>
  <div class="site">
    <div class="title">
        <a href="/">槐花九九</a>
        <a class="extra" href="/archive.html">存档</a>
    </div>
    
    
    <div id="post">
    <h1>Laravel IoC 依赖注入</h1>
    <p class="meta">17 Aug 2012 - By MiniMee</p>

<p>在laravel/core.php中载入的几个核心类中我最不愿提笔记录的便是这个IoC容器。IoC是Inversion of Control的缩写，你可以叫它控制反转，也可以把它理解为依赖注入(DI)。它不是某种技术，只是一种编程思想，往简单点理解，你可以把它当作一种设计模式。</p>

<p>对于编程思想这东西，如果理解了，那么就会觉得简单，反之就会一头雾水。我不想写这部分就是因为我对它只是知的程度，在写过的程序当中很少用到。最直白的表达就是，如果把我用Laravel写的程序拿来，然后注释掉框架IoC相关的部分，程序依然可以运行。下面我只用最简单的方法来说明我对IoC的浅显理解。</p>

<p>一个完全采用面对对象编写的PHP程序实质上就是由N个类(class)相互作用的结果。举个简单的例子，我们有两个类，在执行post类的display函数时需要查询mysql数据库，然后打印post：</p>

<pre><code>// 这是一个模拟场景，并不是Laravel框架环境。
class mysql {
    // 数据库类
}
class post {
    public function display()
    {
        $db = new mysql();
        $post = $db-&gt;table('contents')-&gt;first();
        print_r($post);
    }
}
</code></pre>

<p>post类中通过直接实例化mysql类实现了两个类之间的关系。其实在简单的程序当中我们通常都是直接采用new操作符来实现类与类的相互关系。在例子中post类和mysql类一种直接联系，但是当程序非常复杂的时候，这种直接关系会导致维护困难。</p>

<p>比如现在需要postgresql来代替mysql，那么就必须修改所有与mysql类直接相关的类，这是一个重复而且无趣的工作。这时你可能会想到PDO，没错，PDO可以非常好的解决这个问题。不过在这个例子里我们要用IoC容器来解耦，我们改进下上面的代码：</p>

<pre><code>// 这是一个模拟场景，并不是Laravel框架环境。
class mysql {
    // 数据库类
}
// 偷个懒，直接借用laravel的IoC容器，方便我们理解。
IoC::register('DB',function()
        {
            return new mysql();
        });

class post {
    public function display()
    {
        $db = IoC::resolve('DB');
        $post = $db-&gt;table('contents')-&gt;first();
        print_r($post);
    }
}
</code></pre>

<p>修改之后的代码要比以前更加复杂，不过你可以看到我们已经实现了mysql类和post类的解耦，它们已经没有直接关系了。我们在mysql类和post类之间加了一个IoC容器，起到了粘合剂的作用。现在如果我们要把mysql换为postgresql，没问题，直接修改IoC容器：</p>

<pre><code>IoC::register('DB',function()
        {
            return new postgresql();
        });
</code></pre>

<p>不管程序中有多少类中使用了数据库查询，我们都只需要修改一次IoC容器即可。</p>

<p>现在我们可以来理解为什么叫控制反转或者依赖注入了。我们把post类比做一个小朋友，mysql类比做小卖铺。解耦之前小朋友要吃零食的时候只需要自己去小卖铺买，他知道小卖铺在哪里，小朋友自己把握着吃零食的主动权。但是后来小卖铺搬迁，这下小朋友不知道去哪里买零食了，不过家里请了一个保姆，保姆知道小卖铺的地址。现在小朋友要吃零食时就只能坐在家里等保姆帮他买回来了。</p>

<p>小朋友由之前的主动去买零食变为了被动等保姆买零食，这就是控制反转。依赖注入也是形容这一过程，当小孩要吃零食，保姆就去买来给他，这就是依赖注入。</p>

<p>请原谅我用这么不靠谱的例子来说明，如果理解有误欢迎指正。Laravel框架中IoC容器的基本使用方法和上面例子中相仿，这里就不单独细写了。</p>
    </div>

    <div id="related">
            <div id="disqus_thread"></div>
            <script type="text/javascript">
                /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                var disqus_shortname = 'minimee'; // required: replace example with your forum shortname

                /* * * DON'T EDIT BELOW THIS LINE * * */
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
            <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
            

    </div>

    
    <div class="footer"></div>
  </div>
  <a href="http://github.com/zither"><img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub" /></a>
  <script>hljs.initHighlightingOnLoad();</script>
</body>
</html>
