
<!doctype html>
<html lang="zh-CN">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <title>关于MiniList | 槐花九九</title>
  <meta name="author" content="MiniMee" />
  <link href="/atom.xml" rel="alternate" title="Tom Preston-Werner" type="application/atom+xml" />
  <link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" type="text/css" href="/css/highlight/99_solarized_dark.css" />
  <script src="/js/highlight.pack.js"></script>
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-33950131-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
</head>
<body>
  <div class="site">
    <div class="title">
        <a href="/">槐花九九</a>
        <a class="extra" href="/archive.html">存档</a>
    </div>
    
    
    <div id="post">
    <h1>关于MiniList</h1>
    <p class="meta">30 Aug 2012 - By MiniMee</p>

<p>这两天想写一个非常简单的Todolist，只需要一个PHP文件和一个txt文件。整个程序只有一个功能，就是从txt文件中读取事件，然后生成一个多级嵌套列表。txt文件数据很简单，只是一行一行的文字：</p>

<pre><code>// minilist.txt
Project MiniList
    实现最基本的读取和展示
    改进算法
C语言学习
    Beginning C
Laravel
    中文文档翻译计划
</code></pre>

<p>事件以"\n"为分隔符，事件之间的亲子关系则以空格缩进为依据。最开始的时候花了几分钟写了一个最基础的Demo：</p>

<pre><code>// minilist.php
$mlist = array();
$data = rtrim(file_get_contents('minilist.txt'));
$lists = explode("\n",$data);

$regex = '/^\s{4}.+/';
foreach($lists as $list){
    $num = preg_match($regex,$list);
    if(!$num){
        $mlist[] = array('type'=&gt;0,'value'=&gt;$list);

    }else{
        $mlist[] = array('type'=&gt;1,'value'=&gt;$list);
    }
    }

$output = '&lt;html lang="zh-CN"&gt;
    &lt;meta http-equiv="content-type" content="text/html; charset=utf-8" /&gt;
    &lt;h1&gt;MiniList&lt;/h1&gt;
    &lt;ul&gt;';

$n = count($mlist);
for($i = 0; $i &lt; $n; $i++){
    if($mlist[$i]['type'] == 0 &amp;&amp; $mlist[$i+1]['type'] == 1){
        $output .= "&lt;li&gt;{$mlist[$i]['value']}";
    }else if($mlist[$i]['type']==0){
        $output .= "&lt;li&gt;{$mlist[$i]['value']}&lt;/li&gt;";
    }else if($mlist[$i]['type'] == 1 &amp;&amp; $mlist[$i+1]['type'] == 1){
        $output .= "&lt;ul&gt;&lt;li&gt;{$mlist[$i]['value']}&lt;/li&gt;&lt;/ul&gt;";
    }else{
        $output .= "&lt;ul&gt;&lt;li&gt;{$mlist[$i]['value']}&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;";
    }
}

$output .= '&lt;/ul&gt;&lt;/html&gt;';
echo $output;
</code></pre>

<p>我知道这个几分钟时间拼凑出来的Demo写得很难看，不过它可以表达出我想要的是什么样的效果。</p>

<p>今天重新看了下Demo，觉得只要重写一下列表生成部分的代码就大致可以用了，但是悲剧的是我没有想到什么特别好的办法来解决循环嵌套问题。</p>

<p>你可以看到Demo中用了一堆难看的if-else判断语句，这还是只有二级嵌套，如果多级嵌套的话，我想不出代码有多难看。</p>

<p>暂时只想到一个方法，用数组模拟数据库，每个事件都是一个数组，并且每个数组都有一个parent值来表明亲子关系，例如：</p>

<pre><code>array('1' =&gt; array('parent' =&gt; 1,'value' =&gt; value))
</code></pre>

<p>在生成嵌套的时候只迭代parent为0的根事件，这样可以避免使用累赘的判断，然后在根事件中递归迭代子事件。不过我觉得这样虽然比Demo中好看一点，但是仍然不简洁。</p>

<p>在PHP版Markdown中有现成的嵌套列表生成方法，等自己想不到更好的办法时再去看吧。</p>

<p>代码已经重写，可以查看文章：<a href="http://blog.minimee.org/2012/08/31/a-simple-todo-list.html">用PHP生成嵌套列表</a></p>

<p>--EOF--</p>
    </div>

    <div id="related">
            <div id="disqus_thread"></div>
            <script type="text/javascript">
                /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                var disqus_shortname = 'minimee'; // required: replace example with your forum shortname

                /* * * DON'T EDIT BELOW THIS LINE * * */
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
            <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
            

    </div>

    
    <div class="footer"></div>
  </div>
  <a href="http://github.com/zither"><img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub" /></a>
  <script>hljs.initHighlightingOnLoad();</script>
</body>
</html>
