<!doctype html>
<html lang="zh-cn" class="no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<meta name="description" content="记录在生活以及自学编程过程中好玩的东西。">
	<meta name="keywords" content="MiniThinker, Programming, Computer, PHP, Scheme,">
	<title>Feed 解析那些库 | MiniThinker</title>
	
	<link rel="stylesheet" href="/theme/main.css">
</head>
<body>
	<div id="main">
		<div class="border">
			<header>
				<h1><a href="/">MiniThinker</a></h1>
				<h2>努力学习那些想要知道的东西</h2>
			</header>
			<div id="nav">
				<a href="/">Home</a>
				<a href="/linux">Linux</a>
				<a href="/about">About</a>
			</div>
			<div id="container"><div id="article">
	<article>
		<div class="title">Feed 解析那些库</div>
		<div class="info">
			<span class="date">2014-03-13</span>
			-
			<span class="category">
				Category:
				<a href="/category/Programming">Programming</a>			</span>

					</div>
		<div class="content">
			<p>前几天做了一个比较小的项目，大部分功能都涉及到 feed 解析。关于 feed 解析我之前也写过相关的代码，因为所需 feed 的情况都在自己的控制之内，当时使用的是自己写的一个解析类。这次项目要求要更加通用一些，所以在进行过程搜索了各种开源的 feed 解析库。</p>
<p>最先关注到的解析库是 SimplePie，它的功能比较齐全，基本上支持全格式的 feed 解析，还包括了转码缓存等功能。不过在解析中文订阅的时候会出现将中文编码为 HTML Entities 的问题。随手 google 了一下，发现有人已经遇到过相同的问题：<a href="http://blog.webfuns.net/archives/1710.html">SimplePie 将中文编码成 HTML Entities 的解决办法</a>。</p>
<p></p>
<p>文中已经说明出现这个问题的原因，并且给出了一个解决办法，不过修改方法不太清楚，这里详细说一下：</p>
<pre>
<code class="language-php">// 修改的内容在 SimplePie_Sanitize 类的 sanitize 方法中
class SimplePie_Sanitieze
{
    // 忽略无关的内容
    // ...
    // ...

    public function sanitize($data, $type, $base = '')
    {
        // 忽略无关内容
        // ...
        // ...

        if ($type &amp; (SIMPLEPIE_CONSTRUCT_HTML | SIMPLEPIE_CONSTRUCT_XHTML))
        {
            $document = new DOMDocument();
            $document-&gt;encoding = 'UTF-8';

            // 增加一下两行代码
            $unique_tag = '#' . uniqid() . '#';
            $data = $unique_tag . $data . $unique_tag;

            $data = $this-&gt;preprocess($data, $type);
            // 继续忽略无关内容
            // ...
            // ...

            // 直接注释下面这两行代码
            //$real_body = $document-&gt;getElementsByTagName('body')-&gt;item(0)-&gt;childNodes-&gt;item(0);
            //$document-&gt;replaceChild($real_body, $document-&gt;firstChild);

            $data = trim($document-&gt;saveHTML());

            // 最后在添加下面这行代码
            list($_, $data, $_) = explode($unique_tag, $data);

            // ...
            // ...
        }
    }
}</code>
</pre>
<p>除了 SimplePie 之外还在 Github 上找到一个非常小的解析库：<a href="https://github.com/dzeban/FeedParser">FeedParser</a>。这个库的功能相比 SimplePie 要简陋太多，不过好在它足够简单，源代码看完想怎么改就怎么改。FeedParser 的作者也是因为自己需要而写的，最后更新在 3 年之前，提供的接口是使用 XPath 硬查询的，所以如果有特殊的需求需要自己修改代码。我自己使用的时候也添加过一些简单的接口，代码放在：</p>
<pre>
<code>// FeedParser Github repo
https://github.com/dzeban/FeedParser
// 我小小修改过的
https://github.com/zither/FeedParser</code>
</pre>
<p>总的来说，FeedParser 适合自己玩，正规一些的项目可以考虑使用 SimplePie。</p>		</div>
	</article>
	<div class="bar">
		<span class="new">
			<a href="/article/2014/03/20/the-problem-of-vim-css-color"><< vim-css-color 严重降低 vim 启动速度</a>		</span>
		<span class="old">
			<a href="/article/2014/02/19/confusion-about-closure-in-slim">Slim 中关于 Closure 的问题 >></a>		</span>
		<span class="count">
			18 / 21		</span>
	</div>
	</div>
</div>
			<footer>Powered By <a href="https://github.com/scarwu/Pointless">Pointless</a></footer>
		</div>
	</div>
	<!-- Define and Load Javascript -->
    <script src="http://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
	<script src="/theme/main.js"></script>
	</body>
</html>
